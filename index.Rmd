---
title: "The Statistics of Early Childhood Education in Indonesia"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime:    shiny
       
---


```{r setup, include=FALSE}
pacman::p_load(rio, here, tidyverse, maps, mapdata, ggthemes, ggrepel, rgdal,raster, viridis,sf,terra, colorspace, flexdashboard, plotly,janitor, maptools,ggthemes, viridis,forcats)
```

```{r include=FALSE}
#Load Province name
name <- import(here("data", "name.xlsx"))
name$id <- as.character(name$id)

#Load Indonesia shapefile
idn_shape2 <- rgdal::readOGR(dsn=path.expand("/Users/merlyklaas/Documents/University of Oregon/2022-2023/EDLD 655 Capstone/capstone-project/data/smallest/idn_admbnda_adm1_bps_20200401.shp"),layer = "idn_admbnda_adm1_bps_20200401")
st_drivers()
idn_shape_df <- fortify(idn_shape2)
head(idn_shape_df)
idn <- left_join(idn_shape_df, name)

#Load ECE Data
stat <- import(here("data","stat.xlsx")) %>% 
  clean_names() %>%
  mutate(across(setdiff(names(select(., where(is.character))), 'province'), as.numeric))
dat <- left_join(idn, stat)

str(stat)
growth <- import(here("data","growth.xlsx")) %>%
  pivot_longer(cols=2:11,
               names_to = "year",
               values_to = "number")
        
```


```{r}
year <- stat %>% 
  select(province, all_2017_2018:all_2020_2021, stud_2017_2018:stud_2020_2021, teacher_2017_2018:teacher_2020_2021) %>% 
  pivot_longer(cols = 2:13, 
               names_to = c("type", "year"),
               names_sep = "_",
               values_to = "number")
```



# Overview 

Sidebar Title {.sidebar}
--------------

**General information about ECE Programs in Indonesia**

The First Page of this dashboard contains overall nationwide data about Total number of ECE Programs, total number of students enrolled in all ECE programs, total numbers of ECE Teachers and Facilitators, and total number of classrooms.


```{r include=FALSE}
longdat<- dat %>% 
  select(province, long, lat, group, "ECE centers"=institution, "Students"=participants, "Teachers"=teacher_facilitator) %>% 
  pivot_longer(cols=5:7,
               names_to = "type", 
               values_to = "number")
```

```{r echo=FALSE}


 selectInput("data0", label = h3("Select Data to Show"), 
    choices = list("Number of ECE Centers" = "ECE centers", "Number of Students Enrolled" = "Students", "Number of Teachers" = "Teachers"),
    selected="institution")

selectdata1 <- reactive(as.character(input$data0))
           
```

*Data source:*
Data is taken from the 2020/2021 Annual ECE Statistics Report issued by the Ministry of Education and Cultural. This data reflects ECE Programs statistics in Indonesia as off 30 November 2020.


-------------


Column {.tabset data-width=700}
-----------------------------------------

### Number of ECE Programs

```{r echo=FALSE}

renderPlot({
  longdat %>% 
   filter(type == selectdata1())%>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=number, text=province), color='white')+
  scale_fill_continuous_divergingx(palette = "Earth")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
        legend.position ="bottom",
        legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "# of ECE Programs",
       title = "ECE Programs Availability by Province in Indonesia",
       subtitle = "Java islands have the highest number of ECE Programs",
       x="",
       y="") 

})
```


### Students Enrollment

```{r include=FALSE}
totstu<- dat %>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=participants, text=province), color='white')+
  scale_fill_continuous_divergingx(palette = "Earth")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
       # legend.position ="bottom",
     #   legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "# of Students Enrolled",
       title = "Early Childhood Students Enrollment in ECE Program  by Province in Indonesia",
       subtitle = "Java island has the highest students enrollment in ECE Programs",
       x="",
       y="")
```
```{r}
ggplotly(totstu)
```

### Teacher & Facilitator
```{r include=FALSE}
totteach<- dat %>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=teacher_facilitator, text=province), color='black')+
  scale_fill_continuous_divergingx(palette = "Earth")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
      #  legend.position ="bottom",
     #   legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "# of Teacher",
       title = "Teachers and Facilitors in ECE Program  by Province in Indonesia",
       subtitle = "Java island has the highest students enrollment in ECE Programs",
       x="",
       y="")

```

```{r}
ggplotly(totteach)
```

# Student to Teacher Ratio

Sidebar Title {.sidebar}
--------------

**Student per Teacher Ratio**

The Second Page of this dashboard contains student to teacher ratio by type of ECE Programs aggregated in Province level. There are two main types of ECE Program, Non-formal ECE and Formal ECE. 

There are three types of Non-Formal ECE:

+ Daycare *(Tempat Penitipan Anak)* for	0-6 years old with the Priority for 0-4 years old	
+ Playgroup *(Kelompok Bermain)*	for 2-6 years old with Priority for 3-4 years old	
+ Integrated ECE *(Satuan Paud Sejenis)* for	0-6 years old

And only one type of Formal ECE

+ Kindergarten (Taman Kanak-kanak/ Raudatul Athfal)	for 4-6 years old with priority for 5-6 years old


Thus, in Permendikbud 137 year 2014 about National ECE Standards, the government regulates the maximum student per teacher ratio based on children age:

+ aged 0-2 = 1:4
+ aged 2-4 = 1:8
+ aged 4-6 = 1:15



*Data source:*
Data is taken from the 2020/2021 Annual ECE Statistics Report issued by the Ministry of Education and Cultural. This data reflects ECE Programs statistics in Indonesia as off 30 November 2020.

-------------



Column {.tabset data-width=700}
-----------------------------------------

```{r eval=FALSE, include=FALSE}
renderPlot ({dat %>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=tk_stu_teacher, text=province), color='black')+
   scale_fill_viridis_c(option = "magma", direction=-1)+
  #scale_fill_continuous_divergingx(palette = "Geyser")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
        legend.position ="bottom",
        legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "Ratio",
       title = "Student to Teacher Ratio in Kindergarten",
    #   subtitle = "Java island has the highest students enrollment in ECE Programs",
       x="",
       y="")
})
```



### Kindergarten

```{r include=FALSE}

tkratio<- dat %>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=tk_stu_teacher, text=province), color='black')+
   scale_fill_viridis_c(option = "magma", direction=-1)+
  #scale_fill_continuous_divergingx(palette = "Geyser")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
        legend.position ="bottom",
        legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "Ratio",
       title = "Student to Teacher Ratio in Kindergarten",
    #   subtitle = "Java island has the highest students enrollment in ECE Programs",
       x="",
       y="")

```

```{r}
ggplotly(tkratio)
```

### Daycare

```{r}
tparatio<- dat %>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=tpa_stu_teach, text=province), color='black')+
   scale_fill_viridis_c(option = "magma", direction=-1)+
  #scale_fill_continuous_divergingx(palette = "Geyser")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
        legend.position ="bottom",
        legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "Ratio",
       title = "Student to Teacher Ratio in Daycare",
   #    subtitle = "Java island has the highest students enrollment in ECE Programs",
       x="",
       y="")
```
```{r}
ggplotly(tparatio) %>% config(scrollZoom = TRUE)
```

### Playgroup

```{r}
kbratio<- dat %>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=kb_stu_teach, text=province), color='black')+
   scale_fill_viridis_c(option = "magma", direction=-1)+
  #scale_fill_continuous_divergingx(palette = "Geyser")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
        legend.position ="bottom",
        legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "Ratio",
       title = "Student to Teacher Ratio in Playgroup",
   #    subtitle = "Java island has the highest students enrollment in ECE Programs",
       x="",
       y="")
```
```{r}
ggplotly(kbratio)
```

### Integrated ECE

```{r}
spsratio<- dat %>% 
  ggplot(aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(x=long,y=lat, group=group, fill=sps_stu_teach, text=province), color='black')+
   scale_fill_viridis_c(option = "magma", direction=-1)+
  #scale_fill_continuous_divergingx(palette = "Geyser")+
  ggthemes::theme_map(base_size=8)+
  theme(strip.background = element_blank(),
        legend.position ="bottom",
        legend.direction = "horizontal",
        legend.title = element_text(size = 6), 
        legend.text  = element_text(size = 6),
        legend.key.size = unit(1, "lines"),
        plot.title.position = "plot",
        text=element_text(family= "sans"),
        plot.title = element_text(face="bold"),
        plot.subtitle = element_text(face="italic"),
        plot.caption = element_text(color ="gray30",hjust = 0),
        axis.title = element_text(face = "bold"))+
  labs(fill = "Ratio",
       title = "Student to Teacher Ratio in Integrated ECE",
   #    subtitle = "Java island has the highest students enrollment in ECE Programs",
       x="",
       y="")
```
```{r}
ggplotly(spsratio)
```

# Interactive Growth of ECE Programs at the National Level

Sidebar Title {.sidebar}
--------------

There are three types of Non-Formal ECE:

+ Daycare (Tempat Penitipan Anak) for 0-6 years old with the Priority for 0-4 years old
+ Playgroup (Kelompok Bermain) for 2-6 years old with Priority for 3-4 years old
+ Integrated ECE (Satuan Paud Sejenis) for 0-6 years old

And only one type of Formal ECE

+ Kindergarten (Taman Kanak-kanak/ Raudatul Athfal) for 4-6 years old with priority for 5-6 years old

This page allows you to preview the growth of ECE centers at the national level by type of service offered. 

```{r}


selectInput("type", label = h3("Type of ECE Program"), 
    #choices = unique(growth$type),
    choices = list("All"="All","Kindergarten" = "Kindergarten", "Playgroup" = "Playgroup","Daycare" = "Daycare","Integrated ECD" = "Integrated ECD"),#c("All","Kindergarten","Playgroup","Daycare","Integrated ECD"),
    selected = "All")#,
    #multiple= TRUE)

```


-------------


Column {.tabset data-width=700}
-----------------------------------------

### Number of ECE Programs in National level by type

```{r echo=FALSE}
selecttype <- reactive(as.character(input$type))
```


```{r echo=FALSE}
renderPlot({
growth %>% 
 filter(type %in% selecttype()) %>% 
  ggplot(aes(year, number, fill= type, color=type))+
  #geom_bar(stat= "identity", position = "identity",alpha = .1)+
  geom_point(stat= "identity", position = "identity",alpha = .5, size = 5)+
  geom_line(aes(year, number, group=type,), size=2)+
  theme_minimal() 
  
})
```

# Interactive by Province


Sidebar Title {.sidebar data-width=300}
--------------

This page is designed to visualize the Provincial Level Data for Number of ECE Program, Students, and Teachers across the year.

**Chart A** is Within-Province visualization. Audience can select specific province and range of year data to preview.
<!-- In this chart, all three sub-data (Number of ECE center, Students, and Teachers) are included in one chart to allow the audience to compare the trend of growth throughout the year with the selected province. -->
```{r echo=FALSE}
 selectInput("province", label =("Select Province"), 
    choices = unique(year$province),
    selected = "DKI Jakarta")
 
sliderInput('year', label =('Select Year'), min=2017, max=2020,
            value=min(2017, 2020), step=1, round=0, sep="")

selectprovince <- reactive(as.character(input$province))
selectyear <- reactive(as.numeric(input$year))
```
**Chart B** is Between-Province visualization. Audience can select specific type of data (Number of ECE center, Students, and Teachers) and year to preview. 
<!-- In this chart, audience can compare range of the raw numbers of each type of data variable between province.  -->
```{r}

selectInput("data1", label =("Select Type of Data to Show"), 
    choices = list("ECE Centers" = "all", "Students Enrolled" = "stud", "Teachers" = "teacher"),
    selected="all")

selectdata <- reactive(as.character(input$data1))

selectInput("year1", label =("Select the Year"), 
    choices = unique(year$year),
    selected="2017")

selectyear1 <- reactive(as.numeric(input$year1))

```


Column {data-width=700}
-----------------------------------------

### A. Individual Province Data: Number of Student enrolled, Teacher, & ECE center by Province from 2017-2020

```{r echo=FALSE}

renderPlot ({year %>% 
  filter(province == selectprovince(),
         year <= selectyear()) %>% 
  ggplot(aes(year, number, fill= type, color=type))+
  geom_bar(stat= "identity", position = "identity",alpha = .1, width = .2)+
  geom_point(stat= "identity", position = "identity",alpha = .5, size=5)+
  geom_line(aes(year, number, group=type), size = 2)+
    scale_color_manual(values=c('#063970', '#A69943', '#7843a6'))+
  theme_minimal() 
})
```

### B. Comparison Across Province: Number of Student enrolled, Teacher, & ECE center by Province from 2017-2020

```{r echo=FALSE}

renderPlot ({
  year %>% 
  filter(type == selectdata(),
         year == selectyear1())%>% 
  ggplot()+
  geom_bar(aes(number, fct_reorder(province, number), fill=number), stat = "identity")+ 
  scale_x_continuous(expand = c(0,0))+
  scale_fill_viridis_c(
   option = "viridis", direction = -1)+
  theme_minimal(base_size = 10) +
  theme(axis.text.x=element_text(angle=45,hjust=1),
        legend.key.size = unit(0.3, 'cm'),
        panel.grid.minor=element_blank(),
        plot.background=element_blank(),
        panel.grid.major.x =element_blank()) +
  labs(x="",
       y="",
       fill ="")+
  coord_flip()
})
```

